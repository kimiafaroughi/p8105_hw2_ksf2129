---
title: "p8105_hw2_ksf2129"
author: "Kimia Faroughi"
date: "2025-09-30"
output: github_document
---

```{r setup, echo = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1

Import and clean the `pols-month.csv` dataset.

```{r}
pols_month_df =
  read_csv("fivethirtyeight_datasets/pols-month.csv") |> 
  separate(
  mon, into = c("year", "month", "day"), sep = "-", convert = TRUE
  ) |> #separates mon into year, month, and day based on the dash in the string name and converts to integers
  mutate(
    month = case_match(
    month,
    1 ~ "January",
    2 ~ "February",
    3 ~ "March",
    4 ~ "April",
    5 ~ "May",
    6 ~ "June",
    7 ~ "July",
    8 ~ "August",
    9 ~ "September",
    10 ~ "October",
    11 ~ "November",
    12 ~ "December"
    )
  ) |> #replaces month number with month name
  mutate(
    president = case_match(
      prez_gop,
      1 ~ "gop",
      0 ~ "dem")
  ) |> #creates president var
  select(-prez_gop, -prez_dem, -day) |> #drop prez_gop, prez_dem, and day from dataset
  relocate(year, month) #make year and month the leading columns
```

Clean `snp.csv` in the same way.

```{r}
snp_df =
  read_csv("fivethirtyeight_datasets/snp.csv") |> 
  separate(
  date, into = c("month", "day", "year"), sep = "/", convert = TRUE
  ) |> #separates date into month, day, year based on the slash in the string name and converts to integers
  mutate(
    month = case_match(
    month,
    1 ~ "January",
    2 ~ "February",
    3 ~ "March",
    4 ~ "April",
    5 ~ "May",
    6 ~ "June",
    7 ~ "July",
    8 ~ "August",
    9 ~ "September",
    10 ~ "October",
    11 ~ "November",
    12 ~ "December"
    )
  ) |> #replaces month number with month name
  mutate(
    year = ifelse(year <= 15, 2000 + year, 1900 + year)
    ) |> #add 19 to years 0-15, and 20 to all others (for complete year to be consistent with other datasets)
  select(-day) |> #drop day from dataset
  relocate(year, month) #make year and month the leading columns
```

Tidy the `unemployment.csv` dataset.

```{r}
unemployment_df =
  read_csv("fivethirtyeight_datasets/unemployment.csv") |> 
  pivot_longer(
    cols = Jan:Dec,
    names_to = "month",
    values_to = "unemployment_pct"
  ) |> #puts unemployment % for each month var into one column indicating month and one indicating unemployment %
  mutate(
    month = case_match(
    month,
    "Jan" ~ "January",
    "Feb" ~ "February",
    "Mar" ~ "March",
    "Apr" ~ "April",
    "May" ~ "May",
    "Jun" ~ "June",
    "Jul" ~ "July",
    "Aug" ~ "August",
    "Sep" ~ "September",
    "Oct" ~ "October",
    "Nov" ~ "November",
    "Dec" ~ "December"
    )
  ) |> 
  rename(year = Year) #make column name for year lowercase
```

Join the datasets.

```{r}
#merge snp into pols dataset
pols_snp = 
  left_join(pols_month_df, snp_df, by = c("year", "month"))

#merge unemployment into joint dataset
final_df = 
  left_join(pols_snp, unemployment_df, by = c("year", "month"))
```

The `pols_month.csv` dataset contains 822 observations of 9 variables on the number of national politicians who are democratic or republican at any given time (represented by a yyyy-mm-dd format) in various categories: president, governors, senators, and representatives. The `snp.csv` dataset contains 787 observations of 2 variables on the closing values of the S&P stock index, where each observation is on a different date (represented by a m/d/yy format). The `unemployment.csv` dataset contains 68 observations of 13 variables on the percentage of unemployment with each month as a separate variable, where each observation represents a unique year. 

In the resulting dataset, there are `r nrow(final_df)` rows (observations) and `r ncol(final_df)` columns (variables). The variables in this dataset include: `r names(final_df)`. The range of years included in this dataset is from `r min(final_df$year)` to `r max(final_df$year)`. 


## Problem 2

Import and clean the Mr. Trash Wheel sheet in the `202509 Trash Wheel Collection Data.xlsx` dataset.

```{r}
mr_trash_df = 
  read_excel("202509 Trash Wheel Collection Data.xlsx", 
             sheet = "Mr. Trash Wheel",
             range = "A2:N709") |> #import data from excel, omit non-data
  janitor::clean_names() |> #clean var names
  mutate(sports_balls = round(sports_balls)) |> #round sports balls to nearest integer
  mutate(sports_balls = as.integer(sports_balls)) |> #convert sports balls to integer
  mutate(year = as.double(year)) |> #convert year to double
  mutate(wheel = "mr_trash") #create var for which wheel this is
```

Import and clean the Professor Trash Wheel sheet in the `202509 Trash Wheel Collection Data.xlsx` dataset.

```{r}
prof_trash_df = 
  read_excel("202509 Trash Wheel Collection Data.xlsx", 
             sheet = "Professor Trash Wheel",
             range = "A2:M134") |> #import data from excel, omit non-data
  janitor::clean_names() |> #clean var names
  mutate(wheel = "professor_trash") #create var for which wheel this is
```

Import and clean the Gwynns Falls Trash Wheel sheet in the `202509 Trash Wheel Collection Data.xlsx` dataset.

```{r}
gwynns_falls_df = 
  read_excel("202509 Trash Wheel Collection Data.xlsx", 
             sheet = "Gwynns Falls Trash Wheel",
             range = "A2:L351") |> #import data from excel, omit non-data
  janitor::clean_names() |> #clean var names
  mutate(wheel = "gwynns_falls") #create var for which wheel this is
```

Combine datasets into single tidy dataset.

```{r}
mr_trash_tidy = 
  bind_rows(mr_trash_df, prof_trash_df, gwynns_falls_df)
```

In combining the Mr. Trash Wheel, Professor Trash Wheel, and Gwynns Falls Trash Wheel sheets in the `202509 Trash Wheel Collection Data.xlsx` dataset, the following variables are included: `r names(mr_trash_tidy)`. Key variables include `wheel`, which represents whether the data is from the Mr. Trash, Professor Trash, or Gwynns Falls wheels, and `date`, which represents the date of the observation (each dumpster). `sports_balls` is also important to point out as the variable that represents the number of sports balls counted in each dumpster, but data for `sports_balls` is only available for the Mr. Trash Wheel. `weight_tons` represents the weight in tons of trash collected in each dumpster, and `cigarette_butts` is the number of cigarette butts counted in each dumpster. 

There are `r nrow(mr_trash_tidy)` rows (observations) and `r ncol(mr_trash_tidy)` columns (variables). 

The total weight of trash collected by the Professor Trash Wheel based on available data is `r filter(mr_trash_tidy, wheel == "professor_trash") |> select(weight_tons) |> sum()` tons. The total number of cigarette butts collected by the Gwynns Falls Trash Wheel in June of 2022 based on available data is `r filter(mr_trash_tidy, wheel == "gwynns_falls", month == "June", year == "2022") |> select(cigarette_butts) |> sum()`.

## Problem 3

Import and tidy the `Zip Codes.csv` and `Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv` datasets.

```{r}
zip_codes_df =
  read_csv("zillow_data/Zip Codes.csv") |> 
  janitor::clean_names() |> 
  relocate(zip_code, county, neighborhood) #puts zip code, county, and neighborhood at the front

zip_zori_df =
  read_csv("zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = x2015_01_31:x2024_08_31,
    names_to = "date",
    values_to = "rent",
    names_prefix = "x" #deletes prefix string from each name value
  ) |> #put vars representing each date into its own var with another var corresponding to rent prices
  rename(zip_code = region_name) |> 
  rename(county = county_name) |> 
  mutate(county = str_remove(county, " County")) |> #deletes suffix string from each value
  relocate(zip_code, county, date, rent) #puts zip code, county, date, and rent at the front
```

